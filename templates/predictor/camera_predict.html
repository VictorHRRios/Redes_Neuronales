<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live Bird Prediction</title>
</head>
<body>
    <h1>Live Bird Prediction</h1>
    <video id="webcam" autoplay playsinline width="640" height="480"></video>
    <h2>Prediction: <span id="prediction">Waiting...</span></h2>

    <script>
        const video = document.getElementById('webcam');
        const predictionDisplay = document.getElementById('prediction');

        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
            } catch (error) {
                console.error("Error accessing the camera", error);
            }
        }

        async function captureFrameAndPredict() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convert frame to base64
            const dataURL = canvas.toDataURL('image/jpeg');

            // Send frame to the server
            const response = await fetch('/predictor/predict_from_frame/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ frame: dataURL })
            });

            const result = await response.json();
            if (response.ok) {
                predictionDisplay.textContent = result.prediction;
            } else {
                predictionDisplay.textContent = 'Error';
                console.error(result);
            }
        }

        setupCamera();
        setInterval(captureFrameAndPredict, 1000);  // Capture and predict every second
    </script>
</body>
</html>
